<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Classic Snake Game</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #1a202c; /* Dark background for the page */
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            margin: 0;
            overflow: hidden; /* Prevent scrolling */
        }
        .game-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            background-color: #2d3748; /* Slightly lighter dark background for the container */
            padding: 2rem;
            border-radius: 1rem;
            box-shadow: 0 10px 15px rgba(0, 0, 0, 0.5);
            max-width: 90vw; /* Responsive width */
            max-height: 90vh; /* Responsive height */
            box-sizing: border-box;
        }
        canvas {
            background-color: #0d121c; /* Game board background */
            border: 4px solid #4a5568; /* Border around the game area */
            border-radius: 0.5rem;
            display: block; /* Remove extra space below canvas */
            touch-action: none; /* Prevent browser touch gestures like pull-to-refresh */
        }
        .game-info {
            display: flex;
            justify-content: space-between;
            width: 100%;
            margin-bottom: 1rem;
            color: #e2e8f0; /* Light text color */
            font-size: 1.25rem;
            font-weight: bold;
        }
        .game-message {
            color: #edf2f7;
            font-size: 1.5rem;
            font-weight: bold;
            text-align: center;
            margin-top: 1rem;
            display: none; /* Hidden by default */
        }
        .button-container {
            display: flex;
            gap: 1rem;
            margin-top: 1rem;
        }
        .game-button {
            background-color: #63b3ed; /* Blue for buttons */
            color: white;
            padding: 0.75rem 1.5rem;
            border-radius: 0.5rem;
            font-weight: bold;
            cursor: pointer;
            transition: background-color 0.2s ease-in-out, transform 0.1s ease-in-out;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.2);
            border: none;
            outline: none;
        }
        .game-button:hover {
            background-color: #4299e1;
            transform: translateY(-2px);
        }
        .game-button:active {
            transform: translateY(0);
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
        }
        /* Touch controls */
        .touch-controls {
            display: none; /* Hidden by default, shown via JS for touch devices */
            flex-direction: column;
            align-items: center;
            margin-top: 1.5rem;
        }
        .touch-button {
            background-color: #f6ad55; /* Orange for touch buttons */
            color: #1a202c;
            width: 4rem;
            height: 4rem;
            border-radius: 50%;
            font-size: 2rem;
            font-weight: bold;
            cursor: pointer;
            transition: background-color 0.2s ease-in-out, transform 0.1s ease-in-out;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.2);
            border: none;
            outline: none;
            user-select: none; /* Prevent text selection on tap */
            display: flex;
            justify-content: center;
            align-items: center;
        }
        .touch-button:hover {
            background-color: #ed8936;
            transform: translateY(-2px);
        }
        .touch-button:active {
            transform: translateY(0);
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
        }
        .touch-row {
            display: flex;
            gap: 1rem;
            margin: 0.5rem 0;
        }
        .touch-spacer {
            width: 4rem; /* Match button width for alignment */
            height: 4rem;
        }

        /* Responsive adjustments for smaller screens */
        @media (max-width: 768px) {
             .game-container {
                padding: 1rem;
             }
             canvas {
                /* Make canvas responsive on smaller screens */
                width: 90vw;
                height: 90vw;
             }
        }

        @media (max-width: 640px) {
            .game-info {
                font-size: 1rem;
            }
            .game-message {
                font-size: 1.25rem;
            }
            .game-button {
                padding: 0.5rem 1rem;
                font-size: 0.9rem;
            }
            .touch-button {
                width: 3.5rem;
                height: 3.5rem;
                font-size: 1.5rem;
            }
            .touch-spacer {
                width: 3.5rem;
                height: 3.5rem;
            }
        }
    </style>
</head>
<body class="selection:bg-blue-300 selection:text-white">
    <div class="game-container">
        <div class="game-info">
            <div>Score: <span id="score">0</span></div>
            <div>High Score: <span id="highScore">0</span></div>
        </div>
        <!-- UPDATED: Canvas size increased to 600x600 -->
        <canvas id="gameCanvas" width="600" height="600"></canvas>
        <div id="gameMessage" class="game-message"></div>
        <div class="button-container">
            <button id="startButton" class="game-button">Start Game</button>
            <button id="resetButton" class="game-button" style="display: none;">Reset Game</button>
        </div>

        <div class="touch-controls">
            <div class="touch-row">
                <div class="touch-spacer"></div>
                <button id="upButton" class="touch-button">⬆️</button>
                <div class="touch-spacer"></div>
            </div>
            <div class="touch-row">
                <button id="leftButton" class="touch-button">⬅️</button>
                <div class="touch-spacer"></div>
                <button id="rightButton" class="touch-button">➡️</button>
            </div>
            <div class="touch-row">
                <div class="touch-spacer"></div>
                <button id="downButton" class="touch-button">⬇️</button>
                <div class="touch-spacer"></div>
            </div>
        </div>
    </div>

    <script>
        // Get the canvas element and its 2D rendering context
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');

        // Get score and high score display elements
        const scoreDisplay = document.getElementById('score');
        const highScoreDisplay = document.getElementById('highScore');
        const gameMessage = document.getElementById('gameMessage');
        const startButton = document.getElementById('startButton');
        const resetButton = document.getElementById('resetButton');
        const touchControls = document.querySelector('.touch-controls');

        // Touch control buttons
        const upButton = document.getElementById('upButton');
        const downButton = document.getElementById('downButton');
        const leftButton = document.getElementById('leftButton');
        const rightButton = document.getElementById('rightButton');

        // Game constants
        const GRID_SIZE = 20; // Size of each square in the grid
        const CANVAS_WIDTH = canvas.width;
        const CANVAS_HEIGHT = canvas.height;
        const TILE_COUNT = CANVAS_WIDTH / GRID_SIZE; // Number of tiles horizontally/vertically

        // Game state variables
        let snake;
        let food;
        let score;
        let direction;
        let changingDirection = false; // Flag to prevent multiple direction changes per frame
        let gameInterval; // Stores the interval ID for the game loop
        let gameRunning = false;
        let currentHighScore = localStorage.getItem('snakeHighScore') || 0; // Load high score from local storage

        // --- Game Initialization ---
        function initializeGame() {
            // UPDATED: Snake starts in the center of the new 600x600 canvas
            snake = [
                { x: 15 * GRID_SIZE, y: 15 * GRID_SIZE }, // Head
                { x: 14 * GRID_SIZE, y: 15 * GRID_SIZE },
                { x: 13 * GRID_SIZE, y: 15 * GRID_SIZE }
            ];
            food = {}; // Food will be placed randomly
            score = 0;
            direction = 'RIGHT'; // Initial direction
            changingDirection = false;
            scoreDisplay.textContent = score;
            highScoreDisplay.textContent = currentHighScore;
            gameMessage.style.display = 'none'; // Hide game over message
            startButton.style.display = 'block'; // Show start button
            resetButton.style.display = 'none'; // Hide reset button
            placeFood(); // Place initial food
            draw(); // Draw initial state
            updateTouchControlsVisibility(); // Show/hide touch controls based on screen size
        }

        // --- Game Loop ---
        function mainLoop() {
            if (checkGameOver()) {
                endGame();
                return;
            }

            changingDirection = false; // Reset direction change flag
            clearCanvas();
            drawGrid(); // Draw grid lines
            drawFood();
            moveSnake();
            drawSnake();
        }

        // --- Drawing Functions ---
        function clearCanvas() {
            ctx.fillStyle = '#0d121c'; // Canvas background
            ctx.fillRect(0, 0, CANVAS_WIDTH, CANVAS_HEIGHT);
        }

        function drawGrid() {
            ctx.strokeStyle = '#1e2531'; // Grid line color
            for (let i = 0; i < TILE_COUNT; i++) {
                // Draw vertical lines
                ctx.beginPath();
                ctx.moveTo(i * GRID_SIZE, 0);
                ctx.lineTo(i * GRID_SIZE, CANVAS_HEIGHT);
                ctx.stroke();
                // Draw horizontal lines
                ctx.beginPath();
                ctx.moveTo(0, i * GRID_SIZE);
                ctx.lineTo(CANVAS_WIDTH, i * GRID_SIZE);
                ctx.stroke();
            }
        }

        function drawSnakePart(part) {
            ctx.fillStyle = '#48bb78'; // Snake color (green)
            ctx.strokeStyle = '#2f855a'; // Snake border color (darker green)
            ctx.fillRect(part.x, part.y, GRID_SIZE, GRID_SIZE);
            ctx.strokeRect(part.x, part.y, GRID_SIZE, GRID_SIZE);
        }

        function drawSnake() {
            snake.forEach(drawSnakePart);
        }

        function drawFood() {
            ctx.fillStyle = '#fc8181'; // Food color (red)
            ctx.strokeStyle = '#e53e3e'; // Food border color (darker red)
            ctx.fillRect(food.x, food.y, GRID_SIZE, GRID_SIZE);
            ctx.strokeRect(food.x, food.y, GRID_SIZE, GRID_SIZE);
        }

        // Initial draw for game start/reset
        function draw() {
            clearCanvas();
            drawGrid();
            if(snake) drawSnake();
            if(food) drawFood();
        }

        // --- Game Logic ---
        function moveSnake() {
            // Create the new head
            const head = { x: snake[0].x, y: snake[0].y };

            switch (direction) {
                case 'LEFT':
                    head.x -= GRID_SIZE;
                    break;
                case 'UP':
                    head.y -= GRID_SIZE;
                    break;
                case 'RIGHT':
                    head.x += GRID_SIZE;
                    break;
                case 'DOWN':
                    head.y += GRID_SIZE;
                    break;
            }

            // Add the new head to the beginning of the snake array
            snake.unshift(head);

            // Check if snake ate food
            const didEatFood = head.x === food.x && head.y === food.y;
            if (didEatFood) {
                score++;
                scoreDisplay.textContent = score;
                placeFood(); // Place new food
            } else {
                // Remove the tail if no food was eaten
                snake.pop();
            }
        }

        function placeFood() {
            let foodX, foodY;
            let collisionWithSnake;

            do {
                // Generate random coordinates for food
                foodX = Math.floor(Math.random() * TILE_COUNT) * GRID_SIZE;
                foodY = Math.floor(Math.random() * TILE_COUNT) * GRID_SIZE;

                // Check if new food position collides with any part of the snake
                collisionWithSnake = snake.some(part => part.x === foodX && part.y === foodY);
            } while (collisionWithSnake); // Keep generating until no collision

            food = { x: foodX, y: foodY };
        }

        function checkGameOver() {
            // Check self-collision (snake head hits its own body)
            for (let i = 4; i < snake.length; i++) {
                if (snake[i].x === snake[0].x && snake[i].y === snake[0].y) {
                    return true;
                }
            }

            // Check wall collision
            const hitLeftWall = snake[0].x < 0;
            const hitRightWall = snake[0].x >= CANVAS_WIDTH;
            const hitTopWall = snake[0].y < 0;
            const hitBottomWall = snake[0].y >= CANVAS_HEIGHT;

            return hitLeftWall || hitRightWall || hitTopWall || hitBottomWall;
        }

        function endGame() {
            gameRunning = false;
            clearInterval(gameInterval); // Stop the game loop

            gameMessage.textContent = `Game Over! Your score: ${score}`;
            gameMessage.style.display = 'block';

            if (score > currentHighScore) {
                currentHighScore = score;
                localStorage.setItem('snakeHighScore', currentHighScore);
                highScoreDisplay.textContent = currentHighScore;
                gameMessage.textContent += "\nNew High Score!";
            }

            startButton.style.display = 'none';
            resetButton.style.display = 'block';
        }

        // --- Event Listeners ---
        function changeDirection(event) {
            // Prevent changing direction multiple times within a single frame
            if (changingDirection) return;
            changingDirection = true;

            const keyPressed = event.key;
            const goingUp = direction === 'UP';
            const goingDown = direction === 'DOWN';
            const goingLeft = direction === 'LEFT';
            const goingRight = direction === 'RIGHT';

            if ((keyPressed === 'ArrowLeft' || keyPressed.toLowerCase() === 'a') && !goingRight) {
                direction = 'LEFT';
            } else if ((keyPressed === 'ArrowUp' || keyPressed.toLowerCase() === 'w') && !goingDown) {
                direction = 'UP';
            } else if ((keyPressed === 'ArrowRight' || keyPressed.toLowerCase() === 'd') && !goingLeft) {
                direction = 'RIGHT';
            } else if ((keyPressed === 'ArrowDown' || keyPressed.toLowerCase() === 's') && !goingUp) {
                direction = 'DOWN';
            }
        }

        function startGame() {
            if (gameRunning) return; // Prevent starting if already running
            gameRunning = true;
            startButton.style.display = 'none'; // Hide start button
            resetButton.style.display = 'none'; // Hide reset button
            gameMessage.style.display = 'none'; // Hide message
            // Re-initialize game state for a fresh start, but don't reset high score display
            const currentHighScoreTemp = currentHighScore;
            initializeGame();
            currentHighScore = currentHighScoreTemp;
            highScoreDisplay.textContent = currentHighScore;
            
            // UPDATED: Game speed is slower (150ms interval instead of 100ms)
            gameInterval = setInterval(mainLoop, 150); 
        }

        function resetGame() {
            clearInterval(gameInterval); // Clear any existing interval
            gameRunning = false;
            initializeGame(); // Reset all game variables
            draw(); // Draw the initial game state
        }

        // --- Touch Control Handling ---
        function handleTouchDirection(newDirection) {
             if (changingDirection) return;
             changingDirection = true;

            if (gameRunning) {
                const goingUp = direction === 'UP';
                const goingDown = direction === 'DOWN';
                const goingLeft = direction === 'LEFT';
                const goingRight = direction === 'RIGHT';

                // Prevent immediate reversals
                if (newDirection === 'LEFT' && !goingRight) direction = 'LEFT';
                else if (newDirection === 'UP' && !goingDown) direction = 'UP';
                else if (newDirection === 'RIGHT' && !goingLeft) direction = 'RIGHT';
                else if (newDirection === 'DOWN' && !goingUp) direction = 'DOWN';
            }
        }

        upButton.addEventListener('click', () => handleTouchDirection('UP'));
        downButton.addEventListener('click', () => handleTouchDirection('DOWN'));
        leftButton.addEventListener('click', () => handleTouchDirection('LEFT'));
        rightButton.addEventListener('click', () => handleTouchDirection('RIGHT'));

        // Prevent default touch actions (like scrolling) on canvas
        canvas.addEventListener('touchmove', (e) => e.preventDefault(), { passive: false });

        // Show/hide touch controls based on whether it's a touch device
        function updateTouchControlsVisibility() {
            const isTouchDevice = ('ontouchstart' in window) || (navigator.maxTouchPoints > 0);
            if (isTouchDevice) {
                touchControls.style.display = 'flex';
            } else {
                touchControls.style.display = 'none';
            }
        }

        // Initial setup and event listeners
        window.addEventListener('load', initializeGame);
        document.addEventListener('keydown', changeDirection);
        startButton.addEventListener('click', startGame);
        resetButton.addEventListener('click', resetGame);
        window.addEventListener('resize', updateTouchControlsVisibility); // Adjust on resize
    </script>
</body>
</html>
